<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Allisone Compatibility Checker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #2c6db6;
      --secondary-color: #63b4d1;
      --accent-color: #00a896;
      --light-bg: #f8fafb;
      --dark-text: #333f4d;
    }
    
    body {
      background-color: var(--light-bg);
      padding-top: 80px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%232c6db6' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }

    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      padding: 15px 20px;
      z-index: 1000;
      background: linear-gradient(135deg, #ffffff 0%, #f0f8ff 100%);
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      height: 40px;
      width: auto;
      transition: transform 0.3s ease;
    }
    
    .logo:hover {
      transform: scale(1.05);
    }

    .header-title {
      font-size: 1.2rem;
      color: var(--primary-color);
      font-weight: 500;
      margin: 0;
    }

    #main-container {
      max-width: 800px;
      margin: 40px auto;
    }

    #form-card {
      padding: 30px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: none;
      overflow: hidden;
    }
    
    #form-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);
    }
    
    #form-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    }

    h1 {
      font-size: 1.8rem;
      color: var(--dark-text);
      margin-bottom: 1.8rem;
      text-align: center;
      position: relative;
      padding-bottom: 15px;
    }
    
    h1::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      border-radius: 3px;
    }

    .form-label {
      font-weight: 500;
      color: var(--dark-text);
      display: flex;
      align-items: center;
    }
    
    .form-label i {
      margin-right: 8px;
      color: var(--primary-color);
    }

    .form-select {
      border: 1px solid #e2e8f0;
      padding: 10px 15px;
      border-radius: 8px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
    }
    
    .form-select:focus {
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 3px rgba(99, 180, 209, 0.2);
    }
    
    .btn-reset {
      background-color: #f8f9fa;
      border: 1px solid #e2e8f0;
      color: #6c757d;
      padding: 10px 20px;
      border-radius: 8px;
      transition: all 0.3s ease;
      margin-top: 20px;
    }
    
    .btn-reset:hover {
      background-color: #e9ecef;
    }
    
    .btn-reset i {
      margin-right: 8px;
    }

    #output {
      margin-top: 2rem;
      border-radius: 10px;
      padding: 20px;
      word-wrap: break-word;
      transition: all 0.4s ease;
      border: none;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }
    
    .compatibility-indicator {
      display: inline-flex;
      align-items: center;
      padding: 6px 12px;
      background-color: rgba(25, 135, 84, 0.1);
      color: #198754;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 10px;
    }
    
    .compatibility-indicator i {
      margin-right: 6px;
    }

    .secondary-message {
      font-size: 0.9em;
      color: #6c757d;
      margin-top: 12px;
      padding: 10px;
      background-color: rgba(108, 117, 125, 0.06);
      border-radius: 6px;
    }

    .video-placeholder {
      margin-top: 20px;
      border: 1px dashed #ced4da;
      padding: 15px;
      text-align: center;
      font-style: italic;
      color: #6c757d;
      border-radius: 8px;
      background-color: rgba(0, 0, 0, 0.01);
    }

    video.video-placeholder {
      border: none;
      padding: 0;
      width: 100%;
      height: auto;
      display: block;
      margin-bottom: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .version-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 0.75rem;
      padding: 3px 8px;
      background-color: rgba(44, 109, 182, 0.1);
      color: var(--primary-color);
      border-radius: 12px;
    }
    
    /* Logo display styles */
    .logo-container {
      display: flex;
      justify-content: center;
      margin-top: 30px;
      gap: 30px;
    }
    
    .software-logo {
      text-align: center;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .software-logo img {
      max-width: 100px;
      max-height: 80px;
      border-radius: 8px;
      padding: 10px;
      background-color: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease;
    }
    
    .software-logo img:hover {
      transform: scale(1.05);
    }
    
    .software-logo-label {
      font-size: 0.8rem;
      color: var(--primary-color);
      margin-top: 8px;
      font-weight: 500;
    }
    
    .logo-divider {
      display: flex;
      align-items: center;
      color: var(--primary-color);
      font-size: 1.5rem;
    }
    
    /* Filter buttons */
    .filter-btns {
      margin: 20px 0;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    
    .filter-btn {
      background-color: rgba(44, 109, 182, 0.1);
      color: var(--primary-color);
      border: none;
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    
    .filter-btn:hover, .filter-btn.active {
      background-color: var(--primary-color);
      color: white;
    }
    
    .filter-btn i {
      margin-right: 5px;
    }
    
    /* Improved Compatibility matrix styles */
    #compatibility-matrix {
      margin-top: 40px;
      display: none;
      transition: all 0.3s ease;
    }
    
    .matrix-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
      align-items: center;
    }
    
    .matrix-search {
      flex: 1;
      min-width: 200px;
      position: relative;
    }
    
    .matrix-search input {
      width: 100%;
      padding: 8px 15px 8px 35px;
      border-radius: 20px;
      border: 1px solid #e2e8f0;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }
    
    .matrix-search i {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #6c757d;
    }
    
    .matrix-search input:focus {
      outline: none;
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 3px rgba(99, 180, 209, 0.2);
    }
    
    .matrix-view-options {
      display: flex;
      gap: 5px;
    }
    
    .view-option {
      background: #f8f9fa;
      border: 1px solid #e2e8f0;
      color: #6c757d;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .view-option:hover, .view-option.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    .matrix-table-container {
      overflow-x: auto;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      border-radius: 10px;
      margin-top: 15px;
      max-height: 600px;
      overflow-y: auto;
      position: relative;
      scrollbar-width: thin;
      scrollbar-color: #d1d5db transparent;
    }
    
    .matrix-table-container::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    .matrix-table-container::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .matrix-table-container::-webkit-scrollbar-thumb {
      background-color: #d1d5db;
      border-radius: 20px;
    }
    
    .matrix-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-size: 0.85rem;
    }
    
    .matrix-table th, .matrix-table td {
      padding: 12px;
      text-align: center;
      border: 1px solid #eaedf0;
      position: relative;
    }
    
    .matrix-table th {
      background-color: #f1f5f9;
      position: sticky;
      top: 0;
      z-index: 10;
      font-weight: 600;
      color: var(--primary-color);
      white-space: nowrap;
      padding: 15px 12px;
    }
    
    .matrix-table th:first-child {
      text-align: left;
      z-index: 11;
      left: 0;
      position: sticky;
      background-color: #f1f5f9;
      border-right: 2px solid #dde5ed;
    }
    
    .matrix-table td:first-child {
      font-weight: 500;
      text-align: left;
      position: sticky;
      left: 0;
      background-color: #f8f9fa;
      z-index: 9;
      white-space: nowrap;
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
      border-right: 2px solid #dde5ed;
    }
    
    .matrix-table tr:nth-child(even) {
      background-color: #fcfdfd;
    }
    
    .matrix-table tr:nth-child(even) td:first-child {
      background-color: #f1f5f9;
    }
    
    .matrix-table tr:hover td {
      background-color: rgba(44, 109, 182, 0.05);
    }
    
    .matrix-table tr:hover td:first-child {
      background-color: rgba(44, 109, 182, 0.1);
    }
    
    .matrix-table th.highlighted-col,
    .matrix-table td.highlighted-col {
      background-color: rgba(44, 109, 182, 0.05);
    }
    
    .matrix-section-header {
      background-color: #edf2f7 !important;
      font-weight: 600;
      color: var(--dark-text);
      text-align: left;
      padding-left: 15px;
    }
    
    .compatibility-cell {
      position: relative;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .compatibility-cell:hover {
      transform: scale(1.2);
      z-index: 20;
    }
    
    .compatibility-check {
      color: #198754;
      font-size: 1.1rem;
    }
    
    .compatibility-cross {
      color: #dc3545;
      font-size: 1.1rem;
    }
    
    .compatibility-partial {
      color: #fd7e14;
      font-size: 1.1rem;
    }
    
    .compatibility-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #343a40;
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 0.75rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      z-index: 100;
      width: max-content;
      max-width: 250px;
    }
    
    .compatibility-tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #343a40 transparent transparent transparent;
    }
    
    .compatibility-cell:hover .compatibility-tooltip {
      opacity: 1;
      bottom: calc(100% + 5px);
    }
    
    .matrix-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 15px;
      padding: 10px 15px;
      background-color: #f8f9fa;
      border-radius: 6px;
      font-size: 0.8rem;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
      color: #6c757d;
    }
    
    .export-btn {
      display: inline-flex;
      align-items: center;
      background-color: var(--light-bg);
      color: var(--primary-color);
      border: 1px solid rgba(44, 109, 182, 0.2);
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .export-btn:hover {
      background-color: var(--primary-color);
      color: white;
    }
    
    .export-btn i {
      margin-right: 5px;
    }
    
    /* Documentation link styles */
    .doc-link-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(44, 109, 182, 0.1);
        color: var(--primary-color);
        border: none;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        font-size: 0.8rem;
        transition: all 0.3s ease;
        margin-left: 8px;
        cursor: pointer;
        vertical-align: middle;
    }
    
    .doc-link-btn:hover {
        background-color: var(--primary-color);
        color: white;
    }
    
    .doc-status {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.7rem;
        margin-left: 5px;
        vertical-align: middle;
    }
    
    .doc-status.done {
        background-color: rgba(25, 135, 84, 0.1);
        color: #198754;
    }
    
    .doc-status.progress {
        background-color: rgba(13, 110, 253, 0.1);
        color: #0d6efd;
    }
    
    .compatibility-cell.has-docs {
        position: relative;
    }
    
    .compatibility-cell.has-docs::after {
        content: '';
        position: absolute;
        top: 3px;
        right: 3px;
        width: 7px;
        height: 7px;
        background-color: var(--primary-color);
        border-radius: 50%;
    }
    
    .doc-panel {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.9);
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        width: 90%;
        max-width: 700px;
        max-height: 80vh;
        overflow-y: auto;
        padding: 30px;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }
    
    .doc-panel.active {
        opacity: 1;
        visibility: visible;
        transform: translate(-50%, -50%) scale(1);
    }
    
    .doc-panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        border-bottom: 1px solid #e2e8f0;
        padding-bottom: 15px;
    }
    
    .doc-panel-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--dark-text);
        margin: 0;
    }
    
    .doc-panel-close {
        background: transparent;
        border: none;
        color: #6c757d;
        font-size: 1.2rem;
        cursor: pointer;
        transition: color 0.2s ease;
    }
    
    .doc-panel-close:hover {
        color: var(--dark-text);
    }
    
    .doc-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .doc-list-item {
        margin-bottom: 12px;
        padding-bottom: 12px;
        border-bottom: 1px solid #f5f5f5;
    }
    
    .doc-list-item:last-child {
        border-bottom: none;
    }
    
    .doc-list-link {
        display: flex;
        align-items: center;
        text-decoration: none;
        color: var(--dark-text);
        padding: 8px 12px;
        border-radius: 6px;
        transition: background-color 0.2s ease;
    }
    
    .doc-list-link:hover {
        background-color: #f8f9fa;
    }
    
    .doc-list-icon {
        margin-right: 12px;
        color: var(--primary-color);
        font-size: 1.2rem;
    }
    
    .doc-list-info {
        flex: 1;
    }
    
    .doc-list-title {
        font-weight: 500;
        margin-bottom: 3px;
    }
    
    .doc-list-desc {
        font-size: 0.8rem;
        color: #6c757d;
    }
    
    .doc-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }
    
    .doc-overlay.active {
        opacity: 1;
        visibility: visible;
    }
  </style>
</head>
<body>
    <header>
        <img src="allisone_logo.png" alt="Allisone Logo" class="logo">
        <h2 class="header-title">Compatibility Checker</h2>
        <div style="width: 40px;"></div> <!-- Empty div for balance -->
    </header>

    <div class="container" id="main-container">
        <div class="card" id="form-card">
            <span class="version-badge">v2.0</span>
            <div class="card-body">
                <h1>Allisone Compatibility Checker</h1>
                
                <!-- Smart filters -->
                <div class="filter-btns">
                    <button type="button" class="filter-btn" data-filter="all">
                        <i class="fas fa-th-list"></i> All Software
                    </button>
                    <button type="button" class="filter-btn" data-filter="gateway">
                        <i class="fas fa-network-wired"></i> Gateway Compatible
                    </button>
                    <button type="button" class="filter-btn" data-filter="fullwatcher">
                        <i class="fas fa-eye"></i> Full Watcher
                    </button>
                    <button type="button" class="filter-btn" data-filter="watcherdicom">
                        <i class="fas fa-file-medical"></i> Watcher + Dicom
                    </button>
                    <button type="button" class="filter-btn" data-filter="watcherlight">
                        <i class="fas fa-lightbulb"></i> Watcher Light
                    </button>
                </div>
                
                <form id="compatibilityForm">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <label for="xraySoftware" class="form-label">
                                <i class="fas fa-x-ray"></i> X-ray Software:
                            </label>
                            <select id="xraySoftware" class="form-select">
                                <option value="" selected disabled>Select X-ray software...</option>
                                <!-- Options dynamically populated -->
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="pms" class="form-label">
                                <i class="fas fa-laptop-medical"></i> PMS:
                            </label>
                            <select id="pms" class="form-select">
                                <option value="" selected disabled>Select practice management system...</option>
                                <!-- Options dynamically populated -->
                            </select>
                        </div>
                    </div>
                    
                    <!-- Logo display area -->
                    <div class="logo-container" id="logoDisplay" style="display: none;">
                        <div class="software-logo" id="xrayLogo">
                            <img src="" alt="X-ray Software Logo">
                            <div class="software-logo-label" id="xrayLogoLabel"></div>
                        </div>
                        <div class="logo-divider">
                            <i class="fas fa-plus"></i>
                        </div>
                        <div class="software-logo" id="pmsLogo">
                            <img src="" alt="PMS Logo">
                            <div class="software-logo-label" id="pmsLogoLabel"></div>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button type="button" id="resetButton" class="btn btn-reset">
                            <i class="fas fa-redo-alt"></i> Reset
                        </button>
                    </div>
                </form>

                <div id="output" class="alert alert-info" role="alert" style="display:none;">
                  <div class="compatibility-indicator">
                    <i class="fas fa-check-circle"></i> Compatible
                  </div>
                  <!-- Output will appear here -->
                </div>
                
                <!-- Toggle button for compatibility matrix -->
                <div class="text-center">
                    <button type="button" id="matrixToggleBtn" class="matrix-toggle-btn">
                        <i class="fas fa-table"></i> Show Complete Compatibility Matrix
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Compatibility Matrix Section -->
        <div class="card mt-4" id="compatibility-matrix">
            <div class="card-body">
                <h2 class="h4 mb-3">Complete Compatibility Matrix</h2>
                
                <div class="matrix-controls">
                    <div class="matrix-search">
                        <i class="fas fa-search"></i>
                        <input type="text" id="matrixSearchInput" placeholder="Search software...">
                    </div>
                    
                    <div class="matrix-view-options">
                        <button class="view-option active" data-view="compact">Compact</button>
                        <button class="view-option" data-view="detailed">Detailed</button>
                        <button class="view-option" data-view="grouped">Grouped</button>
                    </div>
                    
                    <button class="export-btn" id="exportMatrix">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
                
                <div class="matrix-legend">
                    <div class="legend-item">
                        <i class="fas fa-check compatibility-check"></i>
                        <span>Full Gateway Compatibility</span>
                    </div>
                    <div class="legend-item">
                        <i class="fas fa-check-circle compatibility-partial"></i>
                        <span>Compatible with Full Watcher</span>
                    </div>
                    <div class="legend-item">
                        <i class="fas fa-exclamation-triangle compatibility-partial"></i>
                        <span>Limited Compatibility</span>
                    </div>
                    <div class="legend-item">
                        <i class="fas fa-times compatibility-cross"></i>
                        <span>Not Compatible</span>
                    </div>
                </div>
                
                <div class="matrix-table-container">
                    <table class="matrix-table" id="matrixTable">
                        <thead>
                            <tr>
                                <th>X-ray Software / PMS</th>
                                <!-- PMS headers will be dynamically inserted here -->
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Table content will be dynamically generated -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add documentation panel -->
    <div class="doc-overlay" id="docOverlay"></div>
    <div class="doc-panel" id="docPanel">
        <div class="doc-panel-header">
            <h3 class="doc-panel-title" id="docPanelTitle">Installation Documentation</h3>
            <button class="doc-panel-close" id="docPanelClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="doc-panel-content">
            <ul class="doc-list" id="docList">
                <!-- Documentation links will be dynamically added here -->
            </ul>
        </div>
    </div>
    
    <script src="script.js"></script>
    <script>
        // Handle reset button
        document.getElementById('resetButton').addEventListener('click', function() {
            document.getElementById('xraySoftware').selectedIndex = 0;
            document.getElementById('pms').selectedIndex = 0;
            document.getElementById('output').style.display = 'none';
            document.getElementById('logoDisplay').style.display = 'none';
        });
        
        // Toggle compatibility matrix
        document.getElementById('matrixToggleBtn').addEventListener('click', function() {
            const matrixSection = document.getElementById('compatibility-matrix');
            const isVisible = matrixSection.style.display !== 'none';
            
            if (isVisible) {
                matrixSection.style.display = 'none';
                this.innerHTML = '<i class="fas fa-table"></i> Show Complete Compatibility Matrix';
            } else {
                matrixSection.style.display = 'block';
                this.innerHTML = '<i class="fas fa-chevron-up"></i> Hide Compatibility Matrix';
                
                // Generate matrix if it hasn't been generated yet
                if (!matrixSection.dataset.generated) {
                    generateCompatibilityMatrix('compact');
                    matrixSection.dataset.generated = 'true';
                }
            }
        });
        
        // Handle view options
        document.querySelectorAll('.view-option').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.view-option').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const viewType = this.dataset.view;
                generateCompatibilityMatrix(viewType);
            });
        });
        
        // Filter matrix with search
        document.getElementById('matrixSearchInput').addEventListener('input', function() {
            const searchText = this.value.toLowerCase();
            const rows = document.querySelectorAll('#matrixTable tbody tr');
            
            rows.forEach(row => {
                if (row.classList.contains('matrix-section-row')) {
                    // Always show section headers
                    row.style.display = '';
                    return;
                }
                
                const xraySoftwareName = row.querySelector('td:first-child').textContent.toLowerCase();
                if (xraySoftwareName.includes(searchText)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
        
        // Export matrix functionality
        document.getElementById('exportMatrix').addEventListener('click', function() {
            // Simple export as CSV
            const rows = document.querySelectorAll('#matrixTable tr');
            let csvContent = "data:text/csv;charset=utf-8,";
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('th, td');
                const rowData = Array.from(cells).map(cell => {
                    // Extract text without the HTML
                    let text = cell.textContent.trim();
                    // For compatibility cells, return the compatibility status
                    if (cell.querySelector('.compatibility-check')) {
                        return "Compatible";
                    } else if (cell.querySelector('.compatibility-partial')) {
                        return "Partially Compatible";
                    } else if (cell.querySelector('.compatibility-cross')) {
                        return "Not Compatible";
                    }
                    return '"' + text.replace(/"/g, '""') + '"';
                }).join(',');
                csvContent += rowData + '\r\n';
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "allisone_compatibility_matrix.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
        
        // Highlight columns on hover
        function addColumnHighlighting() {
            const table = document.getElementById('matrixTable');
            const headerCells = table.querySelectorAll('thead th');
            
            headerCells.forEach((cell, index) => {
                if (index === 0) return; // Skip first column
                
                cell.addEventListener('mouseenter', () => {
                    // Highlight header
                    cell.classList.add('highlighted-col');
                    
                    // Highlight all cells in the same column
                    const rows = table.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const cell = row.querySelectorAll('td')[index];
                        if (cell) cell.classList.add('highlighted-col');
                    });
                });
                
                cell.addEventListener('mouseleave', () => {
                    // Remove highlighting
                    cell.classList.remove('highlighted-col');
                    
                    // Remove highlighting from all cells in column
                    const rows = table.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const cell = row.querySelectorAll('td')[index];
                        if (cell) cell.classList.remove('highlighted-col');
                    });
                });
            });
        }
        
        // Enhanced compatibility matrix generation
        function generateCompatibilityMatrix(viewType) {
            const table = document.getElementById('matrixTable');
            const thead = table.querySelector('thead tr');
            const tbody = table.querySelector('tbody');
            
            // Clear existing content
            while (thead.children.length > 1) {
                thead.removeChild(thead.lastChild);
            }
            tbody.innerHTML = '';
            
            // Add PMS headers
            pmsData.forEach(pms => {
                const th = document.createElement('th');
                th.textContent = pms.split(' - ')[0]; // Just show the name part
                thead.appendChild(th);
            });
            
            if (viewType === 'grouped') {
                // Group software by type
                const groups = {
                    'Full Watcher Dicom': [],
                    'Full Watcher': [],
                    'Watcher Light': [],
                    'Other': []
                };
                
                xraySoftwareData.forEach(software => {
                    if (software.output.includes('Full Watcher Dicom')) {
                        groups['Full Watcher Dicom'].push(software);
                    } else if (software.output.includes('Full Watcher') && !software.output.includes('Dicom')) {
                        groups['Full Watcher'].push(software);
                    } else if (software.output.includes('Watcher Light')) {
                        groups['Watcher Light'].push(software);
                    } else {
                        groups['Other'].push(software);
                    }
                });
                
                // Add groups to table
                Object.entries(groups).forEach(([groupName, softwares]) => {
                    if (softwares.length === 0) return;
                    
                    // Add group header
                    const headerRow = document.createElement('tr');
                    const headerCell = document.createElement('td');
                    headerCell.textContent = groupName;
                    headerCell.colSpan = pmsData.length + 1;
                    headerCell.classList.add('matrix-section-header');
                    headerRow.appendChild(headerCell);
                    headerRow.classList.add('matrix-section-row');
                    tbody.appendChild(headerRow);
                    
                    // Add softwares in group
                    softwares.forEach(software => {
                        addSoftwareRow(software, tbody, viewType);
                    });
                });
            } else {
                // Regular sorting (alphabetical)
                xraySoftwareData.forEach(software => {
                    addSoftwareRow(software, tbody, viewType);
                });
            }
            
            // Add column highlighting
            addColumnHighlighting();
        }
        
        function addSoftwareRow(software, tbody, viewType) {
            const tr = document.createElement('tr');
            
            // Add X-ray software name cell
            const tdName = document.createElement('td');
            if (viewType === 'detailed') {
                tdName.textContent = software.name; // Show full name
            } else {
                tdName.textContent = software.name.split(' - ')[0]; // Just show the name part
            }
            
            // Add documentation link if available
            if (notionLinks.software[software.name]) {
                const docLink = document.createElement('button');
                docLink.classList.add('doc-link-btn');
                docLink.innerHTML = '<i class="fas fa-book"></i>';
                docLink.title = 'View documentation';
                
                // Add click handler to show docs
                docLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Get the documentation URL
                    const docUrl = notionLinks.software[software.name];
                    
                    // Open in new tab
                    window.open(docUrl, '_blank');
                });
                
                tdName.appendChild(docLink);
            }
            
            tr.appendChild(tdName);
            
            // Add compatibility cells for each PMS
            pmsData.forEach(pms => {
                const td = document.createElement('td');
                td.classList.add('compatibility-cell');
                
                let tooltipContent = '';
                
                // Check if integration documentation exists
                const hasIntegrationDoc = notionLinks.integration[software.name]?.[pms];
                
                if (hasIntegrationDoc) {
                    td.classList.add('has-docs');
                }
                
                if (specialCombinations[pms]?.includes(software.name)) {
                    // Full gateway compatibility
                    td.innerHTML = '<i class="fas fa-check compatibility-check"></i>';
                    tooltipContent = 'Fully compatible gateway';
                    
                    if (viewType === 'detailed') {
                        tooltipContent += ' with X-ray acquisition and synchronisation';
                    }
                    
                    if (hasIntegrationDoc) {
                        tooltipContent += ' (Documentation available)';
                    }
                } else if (software.output.includes('Full Watcher Dicom')) {
                    // Full Watcher Dicom
                    td.innerHTML = '<i class="fas fa-check-circle compatibility-partial"></i>';
                    tooltipContent = 'Compatible with Full Watcher Dicom';
                } else if (software.output.includes('Full Watcher')) {
                    // Full Watcher (not Dicom)
                    td.innerHTML = '<i class="fas fa-check-circle compatibility-partial"></i>';
                    tooltipContent = 'Compatible with Full Watcher';
                } else if (software.output.includes('Watcher Light')) {
                    // Watcher Light
                    td.innerHTML = '<i class="fas fa-exclamation-triangle compatibility-partial"></i>';
                    tooltipContent = 'Limited compatibility: Watcher Light + Dicom export';
                } else {
                    // Not compatible
                    td.innerHTML = '<i class="fas fa-times compatibility-cross"></i>';
                    tooltipContent = 'Not compatible';
                }
                
                // Add tooltip
                const tooltip = document.createElement('div');
                tooltip.classList.add('compatibility-tooltip');
                tooltip.textContent = tooltipContent;
                td.appendChild(tooltip);
                
                // Add click handler for cells with documentation
                if (hasIntegrationDoc) {
                    td.addEventListener('click', function() {
                        // Open integration docs
                        window.open(notionLinks.integration[software.name][pms], '_blank');
                    });
                }
                
                tr.appendChild(td);
            });
            
            tbody.appendChild(tr);
        }
        
        // Handle filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const filterType = this.dataset.filter;
                
                // Toggle active state
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Apply filter to dropdowns
                filterSoftwareOptions(filterType);
            });
        });
        
        // Filter software options based on selected filter
        function filterSoftwareOptions(filterType) {
            const xraySelect = document.getElementById('xraySoftware');
            
            // Clear current options except the first one
            while (xraySelect.options.length > 1) {
                xraySelect.remove(1);
            }
            
            // Filter and add options based on the selected filter
            let filteredData = [];
            
            switch(filterType) {
                case 'all':
                    filteredData = xraySoftwareData;
                    break;
                case 'gateway':
                    filteredData = xraySoftwareData.filter(software => 
                        Object.values(specialCombinations).some(combos => 
                            combos.includes(software.name)
                        )
                    );
                    break;
                case 'fullwatcher':
                    filteredData = xraySoftwareData.filter(software => 
                        software.output.includes('Full Watcher') && !software.output.includes('Dicom')
                    );
                    break;
                case 'watcherdicom':
                    filteredData = xraySoftwareData.filter(software => 
                        software.output.includes('Full Watcher Dicom')
                    );
                    break;
                case 'watcherlight':
                    filteredData = xraySoftwareData.filter(software => 
                        software.output.includes('Watcher Light')
                    );
                    break;
                default:
                    filteredData = xraySoftwareData;
            }
            
            // Add filtered options
            filteredData.forEach((software) => {
                const option = document.createElement("option");
                option.value = software.name;
                option.textContent = software.name;
                xraySelect.appendChild(option);
            });
        }
        
        // After the form, add documentation button to show all available docs
        document.addEventListener('DOMContentLoaded', function() {
            // Create docs button
            const docsButton = document.createElement('button');
            docsButton.classList.add('matrix-toggle-btn');
            docsButton.innerHTML = '<i class="fas fa-book"></i> View All Documentation';
            docsButton.style.marginTop = '20px';
            
            // Add button after form
            const form = document.getElementById('compatibilityForm');
            form.parentNode.insertBefore(docsButton, form.nextSibling);
            
            // Add event listener
            docsButton.addEventListener('click', function() {
                showAllDocumentation();
            });
            
            // Setup documentation panel functionality
            setupDocumentationPanel();
        });
        
        // Add script to handle the documentation panel
        function setupDocumentationPanel() {
            const docPanel = document.getElementById('docPanel');
            const docOverlay = document.getElementById('docOverlay');
            const docPanelClose = document.getElementById('docPanelClose');
            
            // Close panel when clicking close button
            docPanelClose.addEventListener('click', function() {
                docPanel.classList.remove('active');
                docOverlay.classList.remove('active');
            });
            
            // Close panel when clicking overlay
            docOverlay.addEventListener('click', function() {
                docPanel.classList.remove('active');
                docOverlay.classList.remove('active');
            });
        }
        
        // Show all documentation
        function showAllDocumentation() {
            const docPanel = document.getElementById('docPanel');
            const docOverlay = document.getElementById('docOverlay');
            const docPanelTitle = document.getElementById('docPanelTitle');
            const docList = document.getElementById('docList');
            
            // Set title
            docPanelTitle.textContent = 'All Installation Guides';
            
            // Clear existing docs
            docList.innerHTML = '';
            
            // Add software documentation links
            const softwareDocs = Object.entries(notionLinks.software);
            
            if (softwareDocs.length > 0) {
                // Add section header
                const softwareHeader = document.createElement('h4');
                softwareHeader.textContent = 'X-ray Software';
                softwareHeader.style.fontSize = '1.1rem';
                softwareHeader.style.marginTop = '10px';
                softwareHeader.style.marginBottom = '15px';
                docList.appendChild(softwareHeader);
                
                // Add software links
                softwareDocs.forEach(([name, url]) => {
                    // Create link item
                    const listItem = createDocListItem(name, url);
                    
                    // Add status indicator
                    if (name.includes('Carestream') || 
                        name.includes('VistaSoft') || 
                        name.includes('Vixwin') || 
                        name.includes('Planmeca') || 
                        name.includes('Sidexis') || 
                        name.includes('Vatech')) {
                        const statusBadge = document.createElement('span');
                        statusBadge.classList.add('doc-status', 'done');
                        statusBadge.textContent = 'Done';
                        listItem.querySelector('.doc-list-title').appendChild(statusBadge);
                    } else if (name.includes('ExaminePro') || 
                               name.includes('iRYS') || 
                               name.includes('Visiquick')) {
                        const statusBadge = document.createElement('span');
                        statusBadge.classList.add('doc-status', 'progress');
                        statusBadge.textContent = 'In Progress';
                        listItem.querySelector('.doc-list-title').appendChild(statusBadge);
                    }
                    
                    docList.appendChild(listItem);
                });
            }
            
            // Add PMS documentation links
            const pmsDocs = Object.entries(notionLinks.pms);
            
            if (pmsDocs.length > 0) {
                // Add section header
                const pmsHeader = document.createElement('h4');
                pmsHeader.textContent = 'PMS Systems';
                pmsHeader.style.fontSize = '1.1rem';
                pmsHeader.style.marginTop = '25px';
                pmsHeader.style.marginBottom = '15px';
                docList.appendChild(pmsHeader);
                
                // Add PMS links
                pmsDocs.forEach(([name, url]) => {
                    const listItem = createDocListItem(name, url);
                    docList.appendChild(listItem);
                });
            }
            
            // Show panel
            docPanel.classList.add('active');
            docOverlay.classList.add('active');
        }
        
        // Create a documentation list item
        function createDocListItem(name, url) {
            const li = document.createElement('li');
            li.classList.add('doc-list-item');
            
            const link = document.createElement('a');
            link.href = url;
            link.target = '_blank';
            link.classList.add('doc-list-link');
            
            const icon = document.createElement('div');
            icon.classList.add('doc-list-icon');
            
            if (name.includes('Carestream') || name.includes('CS Imaging')) {
                icon.innerHTML = '<i class="fas fa-teeth"></i>';
            } else if (name.includes('Julie') || name.includes('Desmos') || name.includes('WeClever')) {
                icon.innerHTML = '<i class="fas fa-laptop-medical"></i>';
            } else {
                icon.innerHTML = '<i class="fas fa-file-alt"></i>';
            }
            
            const info = document.createElement('div');
            info.classList.add('doc-list-info');
            
            const title = document.createElement('div');
            title.classList.add('doc-list-title');
            title.textContent = name;
            
            const desc = document.createElement('div');
            desc.classList.add('doc-list-desc');
            desc.textContent = 'Installation and configuration guide';
            
            info.appendChild(title);
            info.appendChild(desc);
            
            link.appendChild(icon);
            link.appendChild(info);
            
            li.appendChild(link);
            
            return li;
        }
    </script>
</body>
</html>
